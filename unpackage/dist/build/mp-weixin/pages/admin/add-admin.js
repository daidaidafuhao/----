"use strict";const e=require("../../common/vendor.js"),s=require("../../common/api/admin.js"),i={data:()=>({loading:!0,message:"正在添加管理员权限...",success:!1}),onLoad(){this.addCurrentUserAsAdmin()},methods:{addCurrentUserAsAdmin(){const i=e.index.getStorageSync("openid");if(!i)return this.loading=!1,this.message="获取用户信息失败，请先登录",void setTimeout((()=>{e.index.redirectTo({url:"/pages/login/index"})}),1500);s.addAdmin(i,i).then((s=>{this.loading=!1,0===s.code?(this.success=!0,this.message="已成功添加为管理员！",setTimeout((()=>{e.index.redirectTo({url:"/pages/admin/index"})}),3e3)):403===s.code?(this.message="无权执行此操作",setTimeout((()=>{e.index.switchTab({url:"/pages/data-entry/index"})}),1500)):this.message=s.message||"添加管理员失败"})).catch((e=>{this.loading=!1,this.message="操作失败: "+(e.message||"未知错误"),console.error("添加管理员出错",e)}))}}};const t=e._export_sfc(i,[["render",function(s,i,t,n,d,a){return e.e({a:d.loading},d.loading||d.success?{}:{c:e.t(d.message)},{b:d.success})}]]);wx.createPage(t);
