{"version":3,"file":"add-admin.js","sources":["pages/admin/add-admin.vue","../../HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRtaW4vYWRkLWFkbWluLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"header\">\r\n\t\t\t<text class=\"title\">管理员授权</text>\r\n\t\t</view>\r\n\t\t\r\n\t\t<view class=\"content\">\r\n\t\t\t<view class=\"message-box\">\r\n\t\t\t\t<text class=\"loading-text\" v-if=\"loading\">正在处理中...</text>\r\n\t\t\t\t<text class=\"success-icon\" v-else-if=\"success\">✓</text>\r\n\t\t\t\t<text class=\"message-text\" v-else>{{message}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport { addAdmin } from '../../common/api/admin.js';\r\n\t\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tloading: true,\r\n\t\t\t\tmessage: '正在添加管理员权限...',\r\n\t\t\t\tsuccess: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\t// 在页面加载时自动获取当前用户的openid并添加为管理员\r\n\t\t\tthis.addCurrentUserAsAdmin();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\taddCurrentUserAsAdmin() {\r\n\t\t\t\t// 获取当前登录用户的openid\r\n\t\t\t\tconst openid = uni.getStorageSync('openid');\r\n\t\t\t\tif (!openid) {\r\n\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t\tthis.message = '获取用户信息失败，请先登录';\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 跳转到登录页\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\t\t\turl: '/pages/login/index'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, 1500);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// 调用添加管理员API添加自己为管理员\r\n\t\t\t\t// 注意：此处使用自己的openid作为调用者和目标，实际应用中可能需要额外的验证或授权\r\n\t\t\t\taddAdmin(openid, openid)\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (res.code === 0) {\r\n\t\t\t\t\t\t\tthis.success = true;\r\n\t\t\t\t\t\t\tthis.message = '已成功添加为管理员！';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 添加成功后3秒跳转到管理页面\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tuni.redirectTo({\r\n\t\t\t\t\t\t\t\t\turl: '/pages/admin/index'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}, 3000);\r\n\t\t\t\t\t\t} else if (res.code === 403) {\r\n\t\t\t\t\t\t\tthis.message = '无权执行此操作';\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 跳转回普通用户页面\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\t\t\turl: '/pages/data-entry/index'\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}, 1500);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.message = res.message || '添加管理员失败';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(err => {\r\n\t\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t\t\tthis.message = '操作失败: ' + (err.message || '未知错误');\r\n\t\t\t\t\t\tconsole.error('添加管理员出错', err);\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.container {\r\n\t\tpadding: 20px;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\theight: 100vh;\r\n\t}\r\n\t\r\n\t.header {\r\n\t\tmargin-bottom: 40px;\r\n\t\ttext-align: center;\r\n\t}\r\n\t\r\n\t.title {\r\n\t\tfont-size: 24px;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #4095E5;\r\n\t}\r\n\t\r\n\t.content {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\twidth: 100%;\r\n\t}\r\n\t\r\n\t.message-box {\r\n\t\tbackground-color: #fff;\r\n\t\tborder-radius: 10px;\r\n\t\toverflow: hidden;\r\n\t\tbox-shadow: 0 2px 10px rgba(0,0,0,0.05);\r\n\t\tpadding: 30px;\r\n\t\twidth: 80%;\r\n\t\ttext-align: center;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t}\r\n\t\r\n\t.loading-text {\r\n\t\tfont-size: 18px;\r\n\t\tcolor: #666;\r\n\t}\r\n\t\r\n\t.message-text {\r\n\t\tfont-size: 18px;\r\n\t\tcolor: #4095E5;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\t\r\n\t.success-icon {\r\n\t\tfont-size: 60px;\r\n\t\tcolor: #4CAF50;\r\n\t\tmargin-bottom: 20px;\r\n\t}\r\n</style> ","import MiniProgramPage from 'D:/pfh/git/----/pages/admin/add-admin.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","addAdmin"],"mappings":";;;AAmBC,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,SAAS;AAAA,MACT,SAAS;AAAA,MACT,SAAS;AAAA,IACV;AAAA,EACA;AAAA,EACD,SAAS;AAER,SAAK,sBAAqB;AAAA,EAC1B;AAAA,EACD,SAAS;AAAA,IACR,wBAAwB;AAEvB,YAAM,SAASA,cAAAA,MAAI,eAAe,QAAQ;AAC1C,UAAI,CAAC,QAAQ;AACZ,aAAK,UAAU;AACf,aAAK,UAAU;AAGf,mBAAW,MAAM;AAChBA,wBAAAA,MAAI,WAAW;AAAA,YACd,KAAK;AAAA,UACN,CAAC;AAAA,QACD,GAAE,IAAI;AACP;AAAA,MACD;AAIAC,uBAAQ,SAAC,QAAQ,MAAM,EACrB,KAAK,SAAO;AACZ,aAAK,UAAU;AAEf,YAAI,IAAI,SAAS,GAAG;AACnB,eAAK,UAAU;AACf,eAAK,UAAU;AAGf,qBAAW,MAAM;AAChBD,0BAAAA,MAAI,WAAW;AAAA,cACd,KAAK;AAAA,YACN,CAAC;AAAA,UACD,GAAE,GAAI;AAAA,mBACG,IAAI,SAAS,KAAK;AAC5B,eAAK,UAAU;AAGf,qBAAW,MAAM;AAChBA,0BAAAA,MAAI,UAAU;AAAA,cACb,KAAK;AAAA,YACN,CAAC;AAAA,UACD,GAAE,IAAI;AAAA,eACD;AACN,eAAK,UAAU,IAAI,WAAW;AAAA,QAC/B;AAAA,OACA,EACA,MAAM,SAAO;AACb,aAAK,UAAU;AACf,aAAK,UAAU,YAAY,IAAI,WAAW;AAC1CA,sBAAc,MAAA,MAAA,SAAA,mCAAA,WAAW,GAAG;AAAA,MAC7B,CAAC;AAAA,IACH;AAAA,EACD;AACD;;;;;;;;;;;ACnFD,GAAG,WAAW,eAAe;"}