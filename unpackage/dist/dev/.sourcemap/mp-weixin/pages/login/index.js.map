{"version":3,"file":"index.js","sources":["pages/login/index.vue","../../HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vaW5kZXgudnVl"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<view class=\"header\">\n\t\t\t<text class=\"title\">用户登录</text>\n\t\t</view>\n\t\t\n\t\t<view class=\"login-container\">\n\t\t\t<view class=\"avatar-placeholder\">\n\t\t\t\t<image src=\"/static/icons/user-avatar-placeholder.png\" mode=\"aspectFill\"></image>\n\t\t\t</view>\n\t\t\t<view class=\"login-text\">请使用微信账号登录</view>\n\t\t\t<button type=\"primary\" class=\"login-button\" open-type=\"getUserInfo\" @getuserinfo=\"onGetUserInfo\">微信登录</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tloading: false\n\t\t\t}\n\t\t},\n\t\tmethods: {\n\t\t\tonGetUserInfo(e) {\n\t\t\t\t// 如果用户拒绝授权\n\t\t\t\tif (!e.detail.userInfo) {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '需要授权才能使用',\n\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (this.loading) return;\n\t\t\t\tthis.loading = true;\n\t\t\t\t\n\t\t\t\tuni.showLoading({\n\t\t\t\t\ttitle: '登录中...'\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// 获取用户信息\n\t\t\t\tconst userInfo = e.detail.userInfo;\n\t\t\t\t\n\t\t\t\t// 微信登录获取code\n\t\t\t\tuni.login({\n\t\t\t\t\tprovider: 'weixin',\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tconst code = res.code;\n\t\t\t\t\t\tconsole.log('获取到登录code:', code);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// 调用云函数获取openid\n\t\t\t\t\t\tuniCloud.callFunction({\n\t\t\t\t\t\t\tname: 'wx-login',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\tcode: code\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\t\tconsole.log('云函数调用成功:', res);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (res.result && res.result.code === 0) {\n\t\t\t\t\t\t\t\t\t// 保存openid到本地\n\t\t\t\t\t\t\t\t\tuni.setStorageSync('openid', res.result.data.openid);\n\t\t\t\t\t\t\t\t\t// 保存用户信息到本地\n\t\t\t\t\t\t\t\t\tuni.setStorageSync('userInfo', userInfo);\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// 显示成功提示\n\t\t\t\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\t\ttitle: '登录成功',\n\t\t\t\t\t\t\t\t\t\ticon: 'success'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// 获取是否为管理员（从云函数返回）\n\t\t\t\t\t\t\t\t\tconst isAdmin = res.result.data.isAdmin;\n\t\t\t\t\t\t\t\t\tconsole.log('是否为管理员:', isAdmin);\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// 根据用户类型跳转到不同页面\n\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\tif (isAdmin) {\n\t\t\t\t\t\t\t\t\t\t\t// 管理员用户显示选择页面\n\t\t\t\t\t\t\t\t\t\t\tuni.showActionSheet({\n\t\t\t\t\t\t\t\t\t\t\t\titemList: ['管理页面', '填报页面'],\n\t\t\t\t\t\t\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (res.tapIndex === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 选择管理页面\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuni.reLaunch({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: '/pages/admin/index'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// 选择填报页面\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tuni.switchTab({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: '/pages/data-entry/index'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t// 普通用户直接跳转到填报页面\n\t\t\t\t\t\t\t\t\t\t\tuni.switchTab({\n\t\t\t\t\t\t\t\t\t\t\t\turl: '/pages/data-entry/index'\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}, 1500);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// 处理错误情况\n\t\t\t\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\t\t\t\tconsole.error('获取openid失败', res.result);\n\t\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\t\ttitle: '登录失败: ' + (res.result?.msg || '未知错误'),\n\t\t\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfail: (err) => {\n\t\t\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\t\t\tconsole.error('云函数调用失败', err);\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\ttitle: '登录失败，请检查网络'+err.errMsg,\n\t\t\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tfail: (err) => {\n\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\tconsole.error('微信登录失败', err);\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: '登录失败，请重试',\n\t\t\t\t\t\t\ticon: 'none'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.loading = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\t.container {\n\t\tpadding: 20px;\n\t}\n\t\n\t.header {\n\t\tmargin-bottom: 30px;\n\t}\n\t\n\t.title {\n\t\tfont-size: 24px;\n\t\tfont-weight: bold;\n\t\tcolor: #4095E5;\n\t}\n\t\n\t.login-container {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tbackground-color: #fff;\n\t\tborder-radius: 10px;\n\t\tpadding: 40px 15px;\n\t\tbox-shadow: 0 2px 10px rgba(0,0,0,0.05);\n\t}\n\t\n\t.avatar-placeholder {\n\t\twidth: 100px;\n\t\theight: 100px;\n\t\tborder-radius: 50px;\n\t\toverflow: hidden;\n\t\tmargin-bottom: 20px;\n\t}\n\t\n\t.avatar-placeholder image {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\t\n\t.login-text {\n\t\tfont-size: 16px;\n\t\tcolor: #666;\n\t\tmargin-bottom: 30px;\n\t}\n\t\n\t.login-button {\n\t\twidth: 80%;\n\t}\n</style> ","import MiniProgramPage from 'D:/pfh/git/----/pages/login/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud","res"],"mappings":"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"}